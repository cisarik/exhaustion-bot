# Strategy Notes â€“ 1m Dip Hunting (No Trend Gate)

**Dataset:** `data/binance_ADAUSDT_1m.csv` (10k closes).  
**Engine:** `backtest_engine.py` (cash debited at entry, returned at exit; risk sizing from free balance).  
**Profit Check:** `uv run python -m unittest tests/test_profitable_config.py` (same core params, lower risk).  
**Best Run (current `config.json`):**  
- PnL: **+$1.85** on $1,000 initial  
- Trades: 10 | Win Rate: 50 % | Max DD: 0.46 % | Profit Factor: 1.57  
- Run command: `uv run python - <<'PY' ...` mirrored in `.tmp_run_config.py` (removed).

## Parameters in `config.json`
- Levels: L1/L2/L3 = 9/14/20; Lookbacks = 6/6/6
- Filters: RSI on (14, 30/70); **Trend filter off** (EMA blocked signals on this dataset)
- Exits: SL 2.5 %, TP 5 %; Fib exit disabled
- Fees/Slippage: 0.1 % / 0.1 % (set in code)
- Risk: `risk_per_trade` = 5 % of free cash (positions gated by available balance)

## Execution Logic (summary)
- Long only on `bull_l3` (no shorts currently used by config); RSI gate must be oversold; trend gate disabled.
- Position sizing: `risk_per_trade * balance_usdc`; skips if > cash or < $5.
- Equity tracking: longs mark to market; shorts would include margin + unrealized PnL.

## Why This Config
- Highest PnL in sweep without trend filter; EMA200 (or shorter) blocked almost all trades on this bearish/sideways slice.
- Fib exit removed because it reduced trades/PnL in this sample; fixed TP delivered better hit rate.

## How to Reproduce
1) Ensure dataset present: `data/binance_ADAUSDT_1m.csv`.
2) Run regression: `uv run python -m unittest tests/test_profitable_config.py` (uses same levels/SL/TP, lower risk).
3) Run full config check (uses `config.json`):  
   ```bash
   uv run python - <<'PY'
   import json, pandas as pd
   from backtest_engine import BacktestEngine
   cfg=json.load(open('config.json')); data=pd.read_csv('data/binance_ADAUSDT_1m.csv')['close'].tolist()
   eng=BacktestEngine(1000.0); eng.load_data(data)
   s=cfg['strategy']; r=cfg['risk']
   eng.detector.level1=s['level1']; eng.detector.level2=s['level2']; eng.detector.level3=s['level3']
   eng.detector.lookback1=s['lookback1']; eng.detector.lookback2=s['lookback2']; eng.detector.lookback3=s['lookback3']
   eng.use_rsi_filter=s['use_rsi_filter']; eng.rsi_period=s['rsi_period']; eng.rsi_oversold=s['rsi_oversold']; eng.rsi_overbought=s['rsi_overbought']
   eng.use_fib_exit=s['use_fib_exit']; eng.fib_level=s['fib_level']
   eng.stop_loss_pct=r['stop_loss_pct']; eng.take_profit_pct=r['take_profit_pct']; eng.risk_per_trade=r['risk_per_trade']
   eng.fee_pct=0.001; eng.slippage_pct=0.001; eng.use_trend_filter=False
   eng.run(); print(eng.get_metrics())
   PY
   ```

## Next Tuning Ideas
- Try `risk_per_trade` = 3 % for smoother DD (~+$1.11 PnL in tests).
- If market turns bullish, re-enable trend filter with EMA100/200 and rerun the sweep.
- Experiment with L3=18 variant (more trades, lower PnL) if signal frequency is needed.
